<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Docker-Basic</title>
</head>
<body>
  <pre style="font-size: 17px;">
---------------------------------------Giá»›i thiá»‡u vá» Docker--------------------------------------------
-Docker lÃ  má»™t dá»± Ã¡n mÃ£ nguá»“n má»Ÿ giÃºp tá»± Ä‘á»™ng triá»ƒn khai cÃ¡c á»©ng dá»¥ng Linux vÃ  Windows vÃ o trong cÃ¡c container áº£o hÃ³a.
-Image : lÃ  cÃ¡c bá»™ cÃ i nhÆ° Centos,MySQL,ubutu...
-Docker Hub : Noi quáº£n lÃ½ cÃ¡c image giá»‘ng nhÆ° Github
-Container:LÃ  mÃ¡y áº£o táº¡o ra tá»« Image
-Dockerfile:lÃ  má»™t táº­p tin bao gá»“m cÃ¡c chá»‰ dáº«n Ä‘á»ƒ build má»™t image
-volume : LÆ°u data ra ngoÃ i container
-Docker-compose : Edit dockerfile, dÃ¹ng Ä‘á»ƒ cháº¡y multi container Ä‘á»“ng thá»i 
-Docker networks : Docker container cÃ³ IP , Docker network Ä‘á»ƒ káº¿t ná»‘i cÃ¡c container trong cÃ¹ng máº¡ng hoáº·c khÃ¡c máº¡ng vá»›i nhau

-------------------------------------------------------------------------------------------------
ğŸƒğŸ¼â€â™€ï¸ Lab document
CÃ¡c lá»‡nh vá»›i image
- TÃ¬m image Ä‘á»ƒ cÃ i Ä‘áº·t
docker search centos
- List cÃ¡c image Ä‘ang cÃ³
docker image ls
- XÃ³a image
sudo docker rmi [Image ID]
ChÃº Ã½: CÃ¡c image mÃ  cÃ³ container Ä‘ang cháº¡y thÃ¬ sáº½ khÃ´ng xÃ³a Ä‘Æ°á»£c mÃ  pháº£i xÃ³a container liÃªn quan tá»›i nÃ³ trÆ°á»›c
- Pull image vá»
docker pull centos:7

LÃ m viá»‡c vá»›i container

- Cháº¡y 1 container tá»« image
 docker run --privileged -d -p 80:80 hello-world /sbin/init
 docker run --privileged -d -p 172.0.0.1:80 centos:7 /sbin/init
 docker run --privileged -d -p 127.0.0.1:8080:80 tungns2101/project01:v1 /sbin/init

- VÃ o container Ä‘á»ƒ cháº¡y lá»‡nh
docker exec -it [Container ID] /bin/bash 

- CÃ i Ä‘áº·t apache
yum -y install httpd
systemctl start httpd
systemctl enable httpd

echo "Hello Tin Hoc That La Don Gian" > /var/www/html/index.html

- ThoÃ¡t ra khá»i container
exit

- Táº¡o image Ä‘á»ƒ triá»ƒn khai cho mÃ¡y khÃ¡c
docker commit -m "Comment" -a "TÃ¡c giáº£"  [Container ID] [Image Name]
docker commit -m "Centos Project01" -a "Nguyen Son Tung" 17d5e6b7a986 tungns/project01:v1

- ÄÄƒng nháº­p vÃ o docker/hub
docker login

- ÄÆ°a image lÃªn docker hup Ä‘á»ƒ má»i ngÆ°á»i cÃ¹ng sá»­ dá»¥ng
docker push [TÃªn image]
docker push tungns2101/project01:v1
 
- Check cÃ¡c container Ä‘ang cháº¡y
sudo docker ps -a

- Xem tráº¡ng thÃ¡i container
docker container ls -a

- XÃ³a containner
sudo docker rm [Container ID]

- Stop container
docker container stop [Container ID]

- Restart container
docker container restart [Container ID]

- Pause container
docker container pause  [Container ID]

- Truy cáº­p vÃ o cÃ¡c container Ä‘ang cháº¡y
docker container attach [Container ID]


- Lá»‡nh stop toÃ n bá»™ container
docker stop $(docker ps -a -q)

- Lá»‡nh xÃ³a toÃ n bá»™ container
docker rm $(docker ps -a -q)

- Lá»‡nh xÃ³a toÃ n bá»™ image
docker rmi -f $(docker images -a -q)
<hr>
--------------------------------------Dockerfile-------------------------------------------------------
FROM:  láº¥y 1 image trÃªn docker hub
LABEL: ThÃ´ng tin ngÆ°á»i báº£o trÃ¬ dockerfile
ENV : Thiáº¿t láº­p má»™t biáº¿n mÃ´i trÆ°Æ¡ng
RUN : Chá»‰ cháº¡y khi build Image, Ä‘Æ°á»£c sá»­ dá»¥ng Ä‘á»ƒ cÃ i Ä‘áº·t cÃ¡c package vÃ o trong container
COPY : sao chÃ©p cÃ¡c file vÃ  thÆ° má»¥c vÃ o trong container 
ADD : sao chÃ©p cÃ¡c file vÃ  thÆ° má»¥c vÃ o trong container 
CMD : trong 1 Dockerfile chá»‰ cÃ³ 1 CMD , chá»‰ cháº¡y khi thá»¥c hiá»‡n run Ä‘á»ƒ táº¡o ra 1 container
WORKDIR : Thiáº¿t láº­p thÆ° má»¥c lÃ mviá»‡ccho cÃ¡c chá»‰ thá»‹ khÃ¡c nhÆ° :RUN , CMD, ENTRYPOINT, COPY, ADD, ...
ARG : Äá»‹nh nghÄ©a cÃ¡c giÃ¡ trá»‹ biáº¿n Ä‘Æ°á»£c dÃ¹ng trong lÃºcbuild image
ENTRYPOINT : cung cáº¥p cÃ¡c lá»‡nh vÃ  Ä‘Ã´i sá»‘ cho má»™t container thá»±c thi
EXPOSE : Khai bÃ¡o port láº¯ng nghe cá»§a image 
VOLUME : táº¡o má»™t Ä‘iá»ƒm ngáº¯n nhÆ° thÆ° má»¥c Ä‘á»ƒ truy cáº­p vÃ  lÆ°u trá»¯ data
++++++++++++++++++++++
ğŸƒğŸ¼â€â™€ï¸ Lab document
1. Táº¡o Dockerfile

# Get base image
FROM centos:7

# Author
MAINTAINER "Nguyen Quoc Bao"

#Cai dat apache
RUN yum update -y
RUN yum install -y sudo
RUN yum install -y epel-release
RUN yum install -y http://rpms.famillecollet.com/enterpr...
RUN yum clean all
RUN yum -y install wget
RUN yum -y install httpd
RUN yum -y install --enablerepo=remi,remi-php71 php php-devel php-mbstring php-pdo php-gd php-xml php-mcrypt php-pgsql
 
#Thiet lap thu muc lam viec 
WORKDIR /var/www/html

#copy code tu thu muc code vao image
ADD ./code /var/www/html

# start httpd
CMD ["/usr/sbin/httpd", "-D", "FOREGROUND"]

EXPOSE 80


2. Build image
docker build -t httpd_sample . (httpd_sample lÃ  tÃªn image cÃ²n '.'  lÃ  call Ä‘áº¿n file dockerfile hiá»‡n táº¡i)

3. Táº¡o vÃ  cháº¡y container
docker run -d -p 80:80 httpd_sample
<hr>
---------------------------------Docker Compose ---------------------------------------------------
version : Chá»‰ ra phiÃªn báº£n docker-compose Ä‘Ã£ sá»­ dá»¥ng 
services : thiáº¿t láº­p cÃ¡c services(containers) muá»‘n cÃ i Ä‘áº·t vÃ  cháº¡y 
iamge : chá»‰ ra images Ä‘Æ°á»£c sá»­ dá»¥ng trong lÃºc táº¡o ra container
build : dÃ¹ng Ä‘á»ƒ táº¡o container (map tá»›i dockerfile)
ports : thiáº¿t láº­p posts cháº¡y táº¡i mÃ¡y host vÃ  trong container
restart: tá»± khá»Ÿi Ä‘á»™ng cháº¡y khi container bá»‹ táº¯t
environment : thiáº¿t láº­p biáº¿n mÃ´i trÆ°á»ng (thÆ°á»ng sá»­ dá»¥ng trong lÃºc config cÃ¡c thÃ´ng sá»‘ cá»§a db)
depends_on : chá»‰ ra sá»± phá»¥ thuá»™c . tá»©c lÃ  container nÃ o pháº£i Ä‘Æ°á»£c cÃ i Ä‘áº·t vÃ  cháº¡y trÆ°á»›c thÃ¬ container Ä‘Æ°á»£c config táº¡i Ä‘Ã³ má»›i Ä‘Æ°á»£c cháº¡y
volumes: DÃ¹ng Ä‘á»ƒ mount  hai thÆ° má»¥c host vÃ  container vá»›i nhau 
links : Cho phÃ©p Ä‘Äƒng kÃ­ má»™t cÃ¡i tÃªn bÃ­ danh Ä‘á»ƒ cho cÃ¡c server khÃ¡c cÃ³ thá»ƒ gá»i .Äiá»u Ä‘áº·c biá»‡t lÃ  cÃ³ thá»ƒ Ä‘em láº¡i má»™t cÃ¡i tÃªn "há»£p vá»‡  sinh",
chÃºng ta khÃ´ng cáº§n pháº£i nhá»› truy cáº­p trÃªn cá»•ng nÃ o nhÆ° trÃªn host 
Chá»‰ cáº§n sá»­ dá»¥ng tÃªn lÃ  cÃ³ thá»ƒ káº¿t  ná»‘i vá»›i service mong muá»‘n.
Context : xÃ¡c Ä‘á»‹nh thÆ° má»¥c chá»©c gá»‘c . Dá»±a vÃ o thÆ° má»¥c nÃ y chÃºng ta khÃ¡i bÃ¡o tiáº¿p Ä‘Æ°á»ng dáº«n dockerfile
+++++++++++++++++++++++++++++++++++++++++++++
1. CÃ i EC2
#!/bin/bash
yum update -y
yum install -y docker
service docker start
chkconfig docker on
curl -L "https://github.com/docker/compose/releases/download/1.11.2/docker-compose-$(uname -s)-$(uname -m)" -o /usr/local/bin/docker-compose
chmod +x /usr/local/bin/docker-compose


Sample

1. Táº¡o file Dockerfile

FROM centos:7
RUN yum -y update && \
    yum -y install httpd php
WORKDIR /var/www/html
ADD ./code /var/www/html
EXPOSE 80

2.Táº¡o file docker-compose.yml
version: '3'
services:                                                                                       
  web:                                                                                          
    build: .
	command: ["/usr/sbin/httpd","-D","FOREGROUND"]           
    ports:                                                                                      
      - "80:80"
	  
	  
- Build image
$ docker-compose build

- Cháº¡y container
$ docker-compose up -d

- Stop
$ docker-compose stop

- Start láº¡i container
$ docker-compose start

- Stop vÃ  xÃ³a container
$ docker-compose down

https://github.com/dockersamples/example-voting-app
<hr>
------------------------------------------------Thá»±c hÃ nh AWS/ECS-----------------------------------------------

1. CÃ i EC2
#!/bin/bash
yum update -y
yum install -y docker
service docker start
chkconfig docker on
curl -L "https://github.com/docker/compose/releases/download/1.11.2/docker-compose-$(uname -s)-$(uname -m)" -o /usr/local/bin/docker-compose
chmod +x /usr/local/bin/docker-compose


$ mkdir nginx
$ cd nginx
$ vi Dockerfile
FROM nginx
COPY html /usr/share/nginx/html


$ mkdir html
$ vi html/index.html
###
{html>
{head>{title>Tin hoc that la don gian{/title>{/head>
{body>{h1>Xin chao tin hoc that la don gian{/h1>{/body>
{/html>
####

$docker build -t [Image Name]:tag .
	->docker build -t tinhocthatladongian:v1 .

- AWS ECR Login
aws ecr get-login --no-include-email --region eu-west-2


- Táº¡o repository lÃªn AWS/ECR(Amazon Elastic Container Registry)
aws ecr create-repository --repository-name [Repository Name] --region eu-west-2
->aws ecr create-repository --repository-name tinhocthatladongian --region eu-west-2


- Táº¡o tag version docker image
docker tag [Image Name]:tag [Repository ULR] Ä‘Ã£ táº¡o ra á»Ÿ bÆ°á»›c trÃªn]
->docker tag tinhocthatladongian:v1 251123607109.dkr.ecr.eu-west-2.amazonaws.com/tinhocthatladongian

- Push lÃªn AWS/ECR
docker push [Repository ULR]
->docker push 251123607109.dkr.ecr.eu-west-2.amazonaws.com/tinhocthatladongian

- Táº¡o Task trÃªn AWC/ECS
- Táº¡o Clusters trÃªn AWC/ECS

CÃ¡c lá»‡nh xÃ³a Ä‘á»“ng loáº¡t
docker stop $(docker ps -a -q)
docker rm $(docker ps -a -q)
docker rmi -f $(docker images -a -q)
  </pre>
</body>
</html>